{{/* Default static values */}}

{{ $gpgId := "061DF935B288405FF6B906169496153E284399EF" }}
{{ $agePubKey := "age1ajl7y0kkp587nj73xw6cnwyqln6sskj6dullk79pcj5rykw2ayzqny4cym" }}
{{ $sshId := "~/.ssh/cwel.pub" }}
{{ $themes := list
     "dark"
     "light"
}}
{{ $catppuccinFlavors := list
     "latte"
     "frappe"
     "macchiato"
     "mocha"
}}
{{ $catppuccinAccentColors := list
     "blue"
     "flamingo"
     "green"
     "lavender"
     "maroon"
     "mauve"
     "peach"
     "pink"
     "red"
     "rosewater"
     "sapphire"
     "sky"
     "teal"
     "yellow"
}}

{{/* Default dynamic values */}}

{{ $shell := "" }}
{{ $theme := "dark" }}
{{ $catppuccinLightFlavour := "latte" }}
{{ $catppuccinDarkFlavour := "mocha" }}
{{ $catppuccinAccentColor := "lavender" }}
{{ $isLaptop := false }}

{{/* Pre auto */}}

{{ $osId := .chezmoi.os }}
{{ if (and (eq .chezmoi.os "linux") (hasKey .chezmoi.osRelease "id")) }}
  {{ $osId = printf "%s-%s" .chezmoi.os .chezmoi.osRelease.id }}
{{ end }}

{{ if eq $osId "windows" }}
  {{ $shell = "pwsh" }}
{{ else }}
  {{ $shell = "zsh" }}
{{ end }}

{{/* Prompts */}}

{{ if stdinIsATTY }}
  {{ $theme = promptChoice "Theme" $themes "dark" }}
  {{ $catppuccinLightFlavour = promptChoice "Catppuccin flavor for light mode" $catppuccinFlavors "latte" }}
  {{ $catppuccinDarkFlavour = promptChoice "Catppuccin flavor for dark mode" $catppuccinFlavors "mocha" }}
  {{ $catppuccinAccentColor = promptChoice "Catppuccin accent color" $catppuccinAccentColors "lavender" }}
{{ end }}

{{/* Semi prompts or auto */}}

{{ if lookPath "hostnamectl" }}
  {{ if eq (output "hostnamectl" "chassis") "laptop" }}
    {{ $isLaptop = true }}
  {{ end }}
{{ else if lookPath "wmic" }}
  {{ if eq (output "wmic" "computersystem" "get" "PCSystemType" "/VALUE" | trim) "PCSystemType=2" }}
    {{ $isLaptop = true }}
  {{ end }}
{{ else if stdinIsATTY }}
  {{ $isLaptop = promptBoolOnce . "isLaptop" "Is this a laptop" false }}
{{ end }}

{{/* Post auto */}}

{{ $catppuccinFlavor := "" }}
{{ if eq $theme "dark" }}
  {{ $catppuccinFlavor = $catppuccinDarkFlavour }}
{{ else }}
  {{ $catppuccinFlavor = $catppuccinLightFlavour }}
{{ end }}

encryption = "age" # or gpg
mode = "file" # file, symlink
progress = true

[data]
theme = {{ $theme | quote }}
catppuccinLightFlavour = {{ $catppuccinLightFlavour | quote }}
catppuccinDarkFlavour = {{ $catppuccinDarkFlavour | quote }}
catppuccinFlavor = {{ $catppuccinFlavor | quote }}
catppuccinFlavorTitle = {{ $catppuccinFlavor | title | quote }}
catppuccinAccentColor = {{ $catppuccinAccentColor | quote }}
gpgId = {{ $gpgId | quote }}
sshId = {{ $sshId | quote }}
osId = {{ $osId | quote }}
isLaptop = {{ $isLaptop }}

[data.catppuccin]
accentColors = [ {{ $catppuccinAccentColors | quoteList | join ", " }} ]
flavors = [ {{ $catppuccinFlavors | quoteList | join ", " }} ]

[age]
    identity = "~/.ssh/cwel"
    symmetric = true

[gpg]
recipient = {{ $gpgId | quote }}
args = ["--quiet"]

[git]
autoAdd = true # Add changes to the source state after any change
autoCommit = false
autoPush = false

[cd]
command = {{ $shell | quote }}

[completion]
custom = true

[edit]
command = "code"
args = ["--wait"]

[diff]
command = "code"
args = ["--wait", "--diff"]

[merge]
command = "bash"
args = [
    "-c",
    "cp {{ "{{" }} .Target {{ "}}" }} {{ "{{" }} .Target {{ "}}" }}.base && code --new-window --wait --merge {{ "{{" }} .Destination {{ "}}" }} {{ "{{" }} .Target {{ "}}" }} {{ "{{" }} .Target {{ "}}" }}.base {{ "{{" }} .Source {{ "}}" }}",
]
