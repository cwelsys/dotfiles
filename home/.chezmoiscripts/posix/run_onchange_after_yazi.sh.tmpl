#!/bin/bash

set -e

GREEN='\033[0;32m'
CYAN='\033[0;36m'
YELLOW='\033[0;33m'
RED='\033[0;31m'
NC='\033[0m'

install_plugin() {
    local plugin="$1"
    echo -e "${CYAN}Installing plugin: ${plugin}${NC}"

    # Check if yazi supports pkg subcommand (newer versions)
    if ya pkg --help &>/dev/null; then
        # Use new pkg subcommand
        if ya pkg add "$plugin" || true; then
            echo -e "${GREEN}  Success!${NC}"
        else
            echo -e "${RED}  Failed to install plugin: $plugin${NC}"
        fi
    else
        # Use older pack syntax for older yazi versions
        echo -e "${YELLOW}  Using older pack syntax for older yazi version${NC}"
        if ya pack -a "$plugin" || true; then
            echo -e "${GREEN}  Success!${NC}"
        else
            echo -e "${RED}  Failed to install plugin: $plugin${NC}"
        fi
    fi
}

echo -e "${YELLOW}=== Installing yazi plugins ===${NC}"

{{ range .yazi.plugins -}}
install_plugin '{{ . }}'
{{ end }}

echo -e "${YELLOW}=== Listing installed plugins ===${NC}"
if ya pkg --help &>/dev/null; then
    ya pkg list || true
else
    ya pack -l || true
fi

echo -e "${GREEN}=== Done ===${NC}"
