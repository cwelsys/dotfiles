{{- if eq .chezmoi.os "linux" -}}
#!/bin/bash
set -euo pipefail

# Ensure any scripts we run are executable
if [ -d "${HOME}/.chezmoiscripts" ]; then
  find "${HOME}/.chezmoiscripts" -type f -name "*.sh" -exec chmod +x {} \;
fi

# Convert any Windows line endings to Unix
if command -v dos2unix &>/dev/null; then
  find "${HOME}/.chezmoiscripts" -type f -name "*.sh" -exec dos2unix {} \;
else
  echo "dos2unix not found, trying to install..."
  if command -v apt-get &>/dev/null; then
    sudo apt-get update && sudo apt-get install -y dos2unix
  elif command -v dnf &>/dev/null; then
    sudo dnf install -y dos2unix
  elif command -v pacman &>/dev/null; then
    sudo pacman -S --noconfirm dos2unix
  else
    echo "Warning: Unable to install dos2unix automatically."
  fi

  # Try again after installation attempt
  if command -v dos2unix &>/dev/null; then
    find "${HOME}/.chezmoiscripts" -type f -name "*.sh" -exec dos2unix {} \;
  fi
fi
{{- end -}}
