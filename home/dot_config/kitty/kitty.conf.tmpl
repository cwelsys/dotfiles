{{- $mod := "cmd" -}}
{{- if ne .chezmoi.os "darwin" -}}
{{- $mod = "alt" -}}
{{- end }}
## https://sw.kovidgoyal.net/kitty/conf/

# colors
include current-theme.conf
tab_bar_background #1e1e2e
macos_titlebar_color background
active_tab_background #89b4fa
selection_foreground none
selection_background #28344a

# window
window_padding_width 6
placement_strategy center
background_opacity 0.8
background_blur 20
dynamic_background_opacity yes
confirm_os_window_close 0
macos_quit_when_last_window_closed no
remember_window_size yes
hide_window_decorations yes
enabled_layouts splits,*
macos_traditional_fullscreen no
macos_show_window_title_in none

# tabs
tab_bar_style custom
tab_bar_edge top
tab_bar_min_tabs 1

# font
font_size 16
font_family JetBrains Mono
bold_font           auto
italic_font         auto
bold_italic_font    auto
symbol_map U+e000-U+e00a,U+ea60-U+ebeb,U+e0a0-U+e0c8,U+e0ca,U+e0cc-U+e0d7,U+e200-U+e2a9,U+e300-U+e3e3,U+e5fa-U+e6b1,U+e700-U+e7c5,U+ed00-U+efc1,U+f000-U+f2ff,U+f000-U+f2e0,U+f300-U+f372,U+f400-U+f533,U+f0001-U+f1af0 Symbols Nerd Font Mono

# cursor
cursor_trail 3
disable_ligatures cursor
cursor_shape block

# mouse
mouse_hide_wait 0
touch_scroll_multiplier 6.0
copy_on_select yes
focus_follows_mouse yes
mouse_map left doublepress ungrabbed mouse_selection word
mouse_map left triplepress ungrabbed mouse_selection line
mouse_map middle release ungrabbed paste_from_selection

# general
shell_integration disabled
listen_on unix:/tmp/mykitty
allow_remote_control yes
clipboard_control write-clipboard write-primary read-clipboard read-primary
input_delay 2
detect_urls yes
editor nvim
scrollback_lines 10000
strip_trailing_spaces smart
open_url_with default
url_style curly
paste_actions quote-urls-at-prompt
select_by_word_characters @-./_~?&=%+#,|`:"'(){}[]<>

# binds
clear_all_shortcuts yes
macos_option_as_alt yes

# aliases
action_alias klonopin kitten klonopin.py
action_alias kmux_split launch --type=background --cwd=current --copy-env kmux split
action_alias kmux_bg launch --type=background --copy-env kmux
action_alias resize kitten relative_resize.py
action_alias smart_paste kitten smart_paste.py

# leaders
kitty_mod {{ $mod }}+shift
map --new-mode leader --on-unknown end --on-action end ctrl+space
map --mode leader esc pop_keyboard_mode

# ansi
map alt+backspace send_text all \x17
{{ if eq .chezmoi.os "darwin" -}}
map super+backspace send_text all \x15
map super+left send_text all \x01
map super+right send_text all \x05
{{ end -}}
map shift+enter send_text all \x1b[13;2u
map shift+space send_text all \x1b[32;2u
map {{ $mod }}+s send_text all \x13

{{ if eq .chezmoi.os "darwin" -}}
# darwin
map cmd+q quit
map cmd+m minimize_macos_window
map cmd+h no_op
map cmd+k no_op
{{ end -}}

# cmd
map --mode leader shift+; kitty_shell overlay

# copy/paste
map {{ $mod }}+c copy_or_noop
map {{ $mod }}+v paste_from_clipboard
map kitty_mod+v smart_paste
map ctrl+v paste_from_clipboard

# reload cfg
map kitty_mod+r load_config_file

# search buffer
map {{ $mod }}+f launch --type=overlay --stdin-source=@screen_scrollback fzf --no-sort --no-mouse --exact -i --color=bg+:#313244,bg:#1e1e2e,spinner:#f5e0dc,hl:#f38ba8,fg:#cdd6f4,header:#f38ba8,info:#94e2d5,pointer:#f5e0dc,marker:#f5e0dc,fg+:#cdd6f4,prompt:#94e2d5,hl+:#f38ba8,border:#585b70

# show keys/docs
map kitty_mod+/ kitten keymap.py
{{ if eq .chezmoi.os "darwin" -}}
map shift+alt+cmd+/ open_url https://sw.kovidgoyal.net/kitty/
{{ end -}}

# font size
map {{ $mod }}+equal change_font_size all +0.5
map {{ $mod }}+minus change_font_size all -0.5
map {{ $mod }}+0 change_font_size all 0

# pin tabs
map --mode leader shift+p klonopin pin
map --mode leader shift+u klonopin unpin

# set title
map --mode leader r set_tab_title

# reset splits
map --mode leader = resize_window reset

# toggle zoom / flip
map --mode leader z layout_action rotate
map --mode leader space kitten zoom_toggle.py

# fingers
map --mode leader f kitten hints --customize-processing custom-hints.py

# kmux a/d
map --mode leader d kmux_bg detach
map --mode leader p launch --type=overlay --copy-env kmux

# close/create tabs
map {{ $mod }}+w klonopin close-tab
map ctrl+w klonopin close-tab
map {{ $mod }}+t klonopin new-tab
map kitty_mod+t klonopin new-tab --local
map --mode leader q klonopin close-window
map --mode leader x klonopin close-window

# rearrange / navigate tabs
{{ if eq .chezmoi.os "darwin" -}}
map cmd+, no_op
{{ end -}}
map kitty_mod+, klonopin move-left
map kitty_mod+. klonopin move-right
map kitty_mod+l next_tab
map kitty_mod+h previous_tab
map {{ $mod }}+. next_tab
map {{ $mod }}+, previous_tab

# goto tab
map {{ $mod }}+1 goto_tab 1
map {{ $mod }}+2 goto_tab 2
map {{ $mod }}+3 goto_tab 3
map {{ $mod }}+4 goto_tab 4
map {{ $mod }}+5 goto_tab 5
map {{ $mod }}+6 goto_tab 6
map {{ $mod }}+7 goto_tab 7
map {{ $mod }}+8 goto_tab 8
map {{ $mod }}+9 goto_tab 9
map --mode leader 1 goto_tab 1
map --mode leader 2 goto_tab 2
map --mode leader 3 goto_tab 3
map --mode leader 4 goto_tab 4
map --mode leader 5 goto_tab 5
map --mode leader 6 goto_tab 6
map --mode leader 7 goto_tab 7
map --mode leader 8 goto_tab 8
map --mode leader 9 goto_tab 9
map --mode leader 0 goto_tab 10

# splits
map --mode leader \ kmux_split v
map kitty_mod+\ kmux_split v
map kitty_mod+minus kmux_split h
map --mode leader - kmux_split h

# move panes
map --mode leader shift+h move_window left
map --mode leader shift+j move_window down
map --mode leader shift+k move_window up
map --mode leader shift+l move_window right

# change focus between panes
map kitty_mod+left neighboring_window left
map kitty_mod+right neighboring_window right
map kitty_mod+up neighboring_window up
map kitty_mod+down neighboring_window down
map --when-focus-on var:IS_NVIM ctrl+h
map --when-focus-on var:IS_NVIM ctrl+j
map --when-focus-on var:IS_NVIM ctrl+k
map --when-focus-on var:IS_NVIM ctrl+l
map ctrl+alt+shift+super+h neighboring_window left
map ctrl+alt+shift+super+j neighboring_window down
map ctrl+alt+shift+super+k neighboring_window up
map ctrl+alt+shift+super+l neighboring_window right
map --mode leader h neighboring_window left
map --mode leader j neighboring_window down
map --mode leader k neighboring_window up
map --mode leader l neighboring_window right

# resize panes
map alt+h resize left 3
map alt+j resize down 3
map alt+k resize up 3
map alt+l resize right 3
map --when-focus-on var:IS_NVIM alt+h
map --when-focus-on var:IS_NVIM alt+j
map --when-focus-on var:IS_NVIM alt+k
map --when-focus-on var:IS_NVIM alt+l
