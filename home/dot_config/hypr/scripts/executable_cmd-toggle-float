#!/bin/bash
# Toggle floating mode, remembering size and position per window class

STATE_DIR="${XDG_STATE_HOME:-$HOME/.local/state}/hypr-float-sizes"
mkdir -p "$STATE_DIR"

DEFAULT_WIDTH=1500
DEFAULT_HEIGHT=1000

WINDOW_INFO=$(hyprctl activewindow -j)
FLOATING=$(echo "$WINDOW_INFO" | jq -r '.floating')
CLASS=$(echo "$WINDOW_INFO" | jq -r '.class')
STATE_FILE="$STATE_DIR/$CLASS"

if [ "$FLOATING" = "false" ]; then
  if [ -f "$STATE_FILE" ]; then
    read -r WIDTH HEIGHT X Y <"$STATE_FILE"
    hyprctl --batch "dispatch togglefloating; dispatch resizeactive exact $WIDTH $HEIGHT; dispatch moveactive exact $X $Y"
  else
    hyprctl --batch "dispatch togglefloating; dispatch resizeactive exact $DEFAULT_WIDTH $DEFAULT_HEIGHT; dispatch centerwindow"
  fi
else
  WIDTH=$(echo "$WINDOW_INFO" | jq -r '.size[0]')
  HEIGHT=$(echo "$WINDOW_INFO" | jq -r '.size[1]')
  X=$(echo "$WINDOW_INFO" | jq -r '.at[0]')
  Y=$(echo "$WINDOW_INFO" | jq -r '.at[1]')
  echo "$WIDTH $HEIGHT $X $Y" >"$STATE_FILE"
  hyprctl dispatch togglefloating
fi
