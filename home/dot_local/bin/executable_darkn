#!/bin/bash

if [ $# -eq 0 ]; then
    echo "Usage: darkn <app-name>"
    exit 1
fi

bundle_id=$(aid "$*")
if [ -z "$bundle_id" ]; then
    echo "Could not resolve bundle id for: $*"
    exit 1
fi

current=$(defaults read "$bundle_id" NSRequiresAquaSystemAppearance 2>/dev/null)
if [ "$current" = "0" ] || [ "$current" = "" ]; then
    echo "[$bundle_id] Unset → Light"
    defaults write "$bundle_id" NSRequiresAquaSystemAppearance -bool true
else
    echo "[$bundle_id] Light → Dark"
    defaults write "$bundle_id" NSRequiresAquaSystemAppearance -bool false
fi

app_path=$(mdfind "kMDItemCFBundleIdentifier == '$bundle_id'" | head -n1)
app_name=$(basename "$app_path" .app)
killall "$app_name" >/dev/null 2>&1 || true
